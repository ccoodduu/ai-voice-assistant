services:
  tasker-mcp:
    build:
      context: ./phone-tasker-mcp
      dockerfile: Dockerfile
    container_name: tasker-mcp
    restart: unless-stopped
    environment:
      - TASKER_PHONE_HOST=${TASKER_PHONE_HOST:-100.123.253.113}
      - TASKER_PHONE_PORT=${TASKER_PHONE_PORT:-1821}
      - TASKER_TIMEOUT=${TASKER_TIMEOUT:-5.0}
    network_mode: host
    volumes:
      - ./phone-tasker-mcp/tasker_mcp:/app/tasker_mcp:ro
    command: ["python", "-m", "tasker_mcp.server", "--transport", "sse", "--port", "8100"]

  studieplus-mcp:
    build:
      context: ./studieplus-mcp
      dockerfile: Dockerfile
    container_name: studieplus-mcp
    restart: unless-stopped
    environment:
      - STUDIEPLUS_USERNAME=${STUDIEPLUS_USERNAME}
      - STUDIEPLUS_PASSWORD=${STUDIEPLUS_PASSWORD}
      - STUDIEPLUS_SCHOOL=${STUDIEPLUS_SCHOOL:-TECHCOLLEGE}
      - PYTHONPATH=/app/src
      - MCP_TRANSPORT=sse
      - MCP_PORT=8101
    network_mode: host
    volumes:
      - ./studieplus-mcp/src:/app/src:ro
    command: ["python", "-m", "mcp_server.server"]

  ai-server:
    build:
      context: ./ai-server
      dockerfile: Dockerfile
    container_name: ai-server
    restart: unless-stopped
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - PYTHONPATH=/app
      - SPOTIFY_MCP_TOKEN=${SPOTIFY_MCP_TOKEN}
    network_mode: host
    depends_on:
      - tasker-mcp
      - studieplus-mcp
    volumes:
      - ./ai-server/src:/app/src:ro
    command: ["python", "-m", "src.main", "--mode", "webrtc", "--webrtc-port", "8766", "--studieplus-mcp"]

  # Legacy: gemini-live-mcp for local microphone mode
  gemini-live:
    build:
      context: ./gemini-live-mcp
      dockerfile: Dockerfile
    container_name: gemini-live
    restart: "no"
    stdin_open: true
    tty: true
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    network_mode: host
    depends_on:
      - tasker-mcp
    devices:
      - /dev/snd:/dev/snd
    volumes:
      - ./gemini-live-mcp/mcp_config.json:/app/mcp_config.json:ro
    profiles:
      - local
