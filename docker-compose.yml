services:
  tasker-mcp:
    build:
      context: ./phone-tasker-mcp
      dockerfile: Dockerfile
    container_name: tasker-mcp
    restart: unless-stopped
    environment:
      - TASKER_PHONE_HOST=${TASKER_PHONE_HOST:-100.123.253.113}
      - TASKER_PHONE_PORT=${TASKER_PHONE_PORT:-1821}
      - TASKER_TIMEOUT=${TASKER_TIMEOUT:-5.0}
    network_mode: host
    volumes:
      - ./phone-tasker-mcp/tasker_mcp:/app/tasker_mcp:ro

  ai-server:
    build:
      context: ./ai-server
      dockerfile: Dockerfile
    container_name: ai-server
    restart: unless-stopped
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    network_mode: host
    depends_on:
      - tasker-mcp
    volumes:
      - ./ai-server/src:/app/src:ro
    command: ["python", "-m", "src.main", "--mode", "websocket", "--ws-port", "8765"]

  # Legacy: gemini-live-mcp for local microphone mode
  gemini-live:
    build:
      context: ./gemini-live-mcp
      dockerfile: Dockerfile
    container_name: gemini-live
    restart: "no"
    stdin_open: true
    tty: true
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    network_mode: host
    depends_on:
      - tasker-mcp
    devices:
      - /dev/snd:/dev/snd
    volumes:
      - ./gemini-live-mcp/mcp_config.json:/app/mcp_config.json:ro
    profiles:
      - local
